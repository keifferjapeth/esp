<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Terminal - Liquid Glass</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Liquid glass background effects */
        .liquid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            animation: liquidFlow 20s infinite linear;
        }

        @keyframes liquidFlow {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }

            33% {
                transform: translate(-30px, -30px) rotate(120deg);
            }

            66% {
                transform: translate(30px, -20px) rotate(240deg);
            }

            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }

        /* Surface tension effects */
        .surface-tension {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                repeating-linear-gradient(90deg,
                    transparent 0px,
                    rgba(255, 255, 255, 0.01) 1px,
                    transparent 2px),
                repeating-linear-gradient(0deg,
                    transparent 0px,
                    rgba(255, 255, 255, 0.01) 1px,
                    transparent 2px);
            animation: surfaceTension 15s infinite ease-in-out;
        }

        @keyframes surfaceTension {

            0%,
            100% {
                opacity: 0.3;
                transform: scale(1);
            }

            50% {
                opacity: 0.1;
                transform: scale(1.01);
            }
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 10;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Holographic chatbox */
        .holographic-chat {
            width: 90%;
            max-width: 800px;
            height: 80vh;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            animation: hologramGlow 3s infinite ease-in-out;
        }

        @keyframes hologramGlow {

            0%,
            100% {
                box-shadow:
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(255, 255, 255, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }

            50% {
                box-shadow:
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 0 40px rgba(255, 255, 255, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        /* Chat header */
        .chat-header {
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            background: rgba(255, 255, 255, 0.02);
        }

        .chat-title {
            font-size: 1.4rem;
            font-weight: 300;
            color: #ffffff;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .chat-status {
            font-size: 0.9rem;
            color: #ffffff;
            opacity: 0.6;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        /* Chat area */
        .chat-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: calc(80vh - 160px);
        }

        .chat-area::-webkit-scrollbar {
            width: 4px;
        }

        .chat-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 85%;
            animation: messageSlide 0.3s ease-out;
            position: relative;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: rgba(255, 255, 255, 0.1);
            margin-left: auto;
            margin-right: 0;
        }

        .message.assistant {
            background: rgba(255, 255, 255, 0.05);
            margin-left: 0;
            margin-right: auto;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }

        .message.system {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            text-align: center;
            margin: 0 auto;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Input area */
        .input-area {
            padding: 20px 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
        }

        .input-container {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            color: #ffffff;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-field:focus {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .send-button {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: #ffffff;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 80px;
        }

        .send-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Processing indicator */
        .processing {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        .processing-dots {
            display: flex;
            gap: 3px;
        }

        .processing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #ffffff;
            animation: processingPulse 1.5s infinite;
        }

        .processing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .processing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes processingPulse {

            0%,
            80%,
            100% {
                opacity: 0.3;
            }

            40% {
                opacity: 1;
            }
        }

        /* Haptic feedback simulation */
        @keyframes hapticFeedback {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.98);
            }

            100% {
                transform: scale(1);
            }
        }

        .haptic-feedback {
            animation: hapticFeedback 0.1s ease-out;
        }

        /* Memory indicator */
        .memory-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 10px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            font-size: 0.8rem;
            color: #00ff88;
        }

        /* Download link styles */
        .download-link {
            display: inline-block;
            padding: 10px 15px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid rgba(0, 255, 136, 0.5);
            border-radius: 15px;
            color: #00ff88;
            text-decoration: none;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .download-link:hover {
            background: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <!-- Liquid glass background effects -->
    <div class="liquid-background"></div>
    <div class="surface-tension"></div>

    <div class="container">
        <div class="holographic-chat">
            <!-- Memory status indicator -->
            <div class="memory-status" id="memoryStatus">
                üß† Memory: Active
            </div>

            <!-- Chat header -->
            <div class="chat-header">
                <div class="chat-title">Gemini AI Terminal</div>
                <div class="chat-status">
                    <span class="status-dot"></span>
                    Advanced AI ‚Ä¢ Terminal Access ‚Ä¢ SQL Database ‚Ä¢ Learning Enabled
                </div>
            </div>

            <!-- Chat area -->
            <div class="chat-area" id="chatArea">
                <div class="message system">
                    üöÄ <strong>Advanced Gemini AI Terminal Initialized</strong><br>
                    Capabilities: Terminal Execution ‚Ä¢ SQL Queries ‚Ä¢ Data Processing ‚Ä¢ Learning & Memory<br>
                    <em>Just speak naturally - I'll understand and execute your commands</em>
                </div>
            </div>

            <!-- Input area -->
            <div class="input-area">
                <div class="input-container">
                    <input type="text" class="input-field" id="inputField"
                        placeholder="Ask me to run SQL, execute terminal commands, or anything else..."
                        onkeypress="handleKeyPress(event)">
                    <button class="send-button" id="sendButton" onclick="sendMessage()">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Advanced AI Configuration
        const AI_CONFIG = {
            geminiApiKey: 'AIzaSyBQWBs2HYmllkp5t37QEwIhF0viJ8vWMZs',
            tildaApiKey: 'b9j7w8eka0dwsizitkix',
            memoryKey: 'gemini_ai_memory',
            sqlDbKey: 'gemini_sql_database'
        };

        // AI Memory and Learning System
        class GeminiMemory {
            constructor() {
                this.memory = this.loadMemory();
                this.conversationHistory = [];
                this.learningDatabase = this.loadLearningDb();
                this.validateMemory(); // Ensure memory structure is complete
            }

            validateMemory() {
                // Ensure personality object exists with required properties
                if (!this.memory.personality) {
                    this.memory.personality = {
                        creator: 'Keiffer Japeth',
                        creation_date: '2025-11-04',
                        system_name: 'Keiffer\'s Custom Gemini AI Terminal',
                        traits: ['helpful', 'intelligent', 'customizable', 'learning'],
                        customizations: []
                    };
                }

                // Ensure core_facts exist
                if (!this.memory.core_facts) {
                    this.memory.core_facts = {
                        'who created you': 'I was created by Keiffer Japeth as a customizable AI terminal system.',
                        'what are you': 'I am Keiffer\'s custom Gemini AI Terminal with advanced capabilities including SQL, terminal access, and learning.',
                        'your purpose': 'I help Keiffer with real estate data, SQL queries, terminal commands, and general AI assistance.',
                        'customizable': true
                    };
                }

                // Ensure other required arrays exist
                if (!this.memory.conversations) this.memory.conversations = [];
                if (!this.memory.learned_facts) this.memory.learned_facts = [];
                if (!this.memory.sql_patterns) this.memory.sql_patterns = [];
                if (!this.memory.command_patterns) this.memory.command_patterns = [];

                this.saveMemory(); // Save the validated memory
            }

            loadMemory() {
                const stored = localStorage.getItem(AI_CONFIG.memoryKey);
                return stored ? JSON.parse(stored) : {
                    conversations: [],
                    learned_facts: [],
                    preferences: {},
                    sql_schemas: {},
                    command_patterns: [],
                    personality: {
                        creator: 'Keiffer Japeth',
                        creation_date: '2025-11-04',
                        system_name: 'Keiffer\'s Custom Gemini AI Terminal',
                        traits: ['helpful', 'intelligent', 'customizable', 'learning'],
                        customizations: []
                    },
                    core_facts: {
                        'who created you': 'I was created by Keiffer Japeth as a customizable AI terminal system.',
                        'what are you': 'I am Keiffer\'s custom Gemini AI Terminal with advanced capabilities including SQL, terminal access, and learning.',
                        'your purpose': 'I help Keiffer with real estate data, SQL queries, terminal commands, and general AI assistance.',
                        'customizable': true
                    }
                };
            }

            saveMemory() {
                localStorage.setItem(AI_CONFIG.memoryKey, JSON.stringify(this.memory));
            }

            loadLearningDb() {
                const stored = localStorage.getItem(AI_CONFIG.sqlDbKey);
                return stored ? JSON.parse(stored) : {
                    tables: {},
                    queries: [],
                    results: []
                };
            }

            saveLearningDb() {
                localStorage.setItem(AI_CONFIG.sqlDbKey, JSON.stringify(this.learningDatabase));
            }

            addToMemory(type, data) {
                if (!this.memory[type]) this.memory[type] = [];
                this.memory[type].push({
                    timestamp: new Date().toISOString(),
                    data: data
                });
                this.saveMemory();
            }

            remember(query) {
                const context = this.memory.conversations.slice(-10); // Last 10 conversations for context
                return context;
            }

            learn(input, output, type = 'conversation') {
                this.addToMemory('conversations', { input, output, type });

                // Extract learning patterns
                if (input.toLowerCase().includes('sql')) {
                    this.addToMemory('sql_patterns', input);
                }

                if (input.toLowerCase().includes('run') || input.toLowerCase().includes('execute')) {
                    this.addToMemory('command_patterns', input);
                }

                this.updateMemoryStatus();
            }

            updateMemoryStatus() {
                const total = this.memory.conversations.length;
                document.getElementById('memoryStatus').textContent = `üß† Memory: ${total} items`;
            }
        }

        // SQL Database System
        class SQLConsole {
            constructor() {
                this.tables = this.loadTables();
            }

            loadTables() {
                return {
                    users: [
                        { id: 1, name: 'John Doe', email: 'john@example.com', role: 'admin', created: '2025-01-01' },
                        { id: 2, name: 'Jane Smith', email: 'jane@example.com', role: 'broker', created: '2025-01-15' },
                        { id: 3, name: 'Mike Johnson', email: 'mike@example.com', role: 'agent', created: '2025-02-01' },
                        { id: 4, name: 'Sarah Wilson', email: 'sarah@example.com', role: 'agent', created: '2025-02-15' }
                    ],
                    brokers: [
                        { id: 1, name: 'Jane Smith', company: 'Premium Realty', license: 'BR123456', commission_rate: 0.06, active: true, territory: 'North District' },
                        { id: 2, name: 'Robert Brown', company: 'Elite Properties', license: 'BR234567', commission_rate: 0.055, active: true, territory: 'South District' },
                        { id: 3, name: 'Lisa Davis', company: 'Metro Homes', license: 'BR345678', commission_rate: 0.065, active: true, territory: 'Central District' }
                    ],
                    agents: [
                        { id: 1, name: 'Mike Johnson', broker_id: 1, license: 'AG789012', sales_ytd: 2500000, properties_sold: 15, rating: 4.8, active: true },
                        { id: 2, name: 'Sarah Wilson', broker_id: 1, license: 'AG890123', sales_ytd: 1800000, properties_sold: 12, rating: 4.6, active: true },
                        { id: 3, name: 'David Lee', broker_id: 2, license: 'AG901234', sales_ytd: 3200000, properties_sold: 20, rating: 4.9, active: true },
                        { id: 4, name: 'Emily Chen', broker_id: 3, license: 'AG012345', sales_ytd: 2100000, properties_sold: 14, rating: 4.7, active: true },
                        { id: 5, name: 'Tom Anderson', broker_id: 2, license: 'AG123456', sales_ytd: 1500000, properties_sold: 9, rating: 4.4, active: false }
                    ],
                    projects: [
                        { id: 1, name: 'Crystal AI', status: 'active', user_id: 1, budget: 50000, completion: 85 },
                        { id: 2, name: 'SQL Console', status: 'development', user_id: 2, budget: 30000, completion: 60 },
                        { id: 3, name: 'Agent Dashboard', status: 'planning', user_id: 3, budget: 75000, completion: 10 },
                        { id: 4, name: 'Broker Analytics', status: 'active', user_id: 4, budget: 40000, completion: 40 }
                    ],
                    properties: [
                        { id: 1, address: '123 Main St', price: 450000, agent_id: 1, broker_id: 1, status: 'sold', beds: 3, baths: 2 },
                        { id: 2, address: '456 Oak Ave', price: 620000, agent_id: 2, broker_id: 1, status: 'active', beds: 4, baths: 3 },
                        { id: 3, address: '789 Pine Rd', price: 380000, agent_id: 3, broker_id: 2, status: 'pending', beds: 2, baths: 2 },
                        { id: 4, address: '321 Elm St', price: 750000, agent_id: 4, broker_id: 3, status: 'active', beds: 5, baths: 4 }
                    ],
                    transactions: [
                        { id: 1, property_id: 1, agent_id: 1, broker_id: 1, sale_price: 450000, commission: 27000, date: '2025-10-15' },
                        { id: 2, property_id: 3, agent_id: 3, broker_id: 2, sale_price: 380000, commission: 20900, date: '2025-10-20' }
                    ],
                    logs: [
                        { id: 1, action: 'login', user_id: 1, timestamp: '2025-11-04 10:00:00', ip: '192.168.1.100' },
                        { id: 2, action: 'query', user_id: 2, timestamp: '2025-11-04 11:30:00', ip: '192.168.1.101' },
                        { id: 3, action: 'property_view', user_id: 3, timestamp: '2025-11-04 12:15:00', ip: '192.168.1.102' },
                        { id: 4, action: 'commission_calc', user_id: 4, timestamp: '2025-11-04 13:45:00', ip: '192.168.1.103' }
                    ]
                };
            }

            executeQuery(sql) {
                try {
                    const query = sql.toLowerCase().trim();

                    if (query.includes('select')) {
                        return this.handleSelect(sql);
                    } else if (query.includes('insert')) {
                        return this.handleInsert(sql);
                    } else if (query.includes('update')) {
                        return this.handleUpdate(sql);
                    } else if (query.includes('delete')) {
                        return this.handleDelete(sql);
                    } else if (query.includes('create')) {
                        return this.handleCreate(sql);
                    } else {
                        return { error: 'Unsupported SQL command', query: sql };
                    }
                } catch (error) {
                    return { error: error.message, query: sql };
                }
            }

            handleSelect(sql) {
                const tableName = this.extractTableName(sql);
                if (this.tables[tableName]) {
                    return {
                        success: true,
                        data: this.tables[tableName],
                        query: sql,
                        rows: this.tables[tableName].length
                    };
                } else {
                    return { error: `Table '${tableName}' not found`, query: sql };
                }
            }

            handleInsert(sql) {
                // Simplified insert handling
                return {
                    success: true,
                    message: 'Insert simulated successfully',
                    query: sql,
                    affected_rows: 1
                };
            }

            handleUpdate(sql) {
                return {
                    success: true,
                    message: 'Update simulated successfully',
                    query: sql,
                    affected_rows: 1
                };
            }

            handleDelete(sql) {
                return {
                    success: true,
                    message: 'Delete simulated successfully',
                    query: sql,
                    affected_rows: 1
                };
            }

            handleCreate(sql) {
                return {
                    success: true,
                    message: 'Table creation simulated successfully',
                    query: sql
                };
            }

            extractTableName(sql) {
                const match = sql.match(/(?:from|into|update|table)\s+(\w+)/i);
                return match ? match[1] : 'unknown';
            }

            listTables() {
                return Object.keys(this.tables);
            }

            describeTable(tableName) {
                const table = this.tables[tableName];
                if (table && table.length > 0) {
                    const columns = Object.keys(table[0]);
                    return { table: tableName, columns: columns, rows: table.length };
                }
                return { error: `Table '${tableName}' not found or empty` };
            }
        }

        // Terminal Command Executor
        class TerminalExecutor {
            constructor() {
                this.commandHistory = [];
            }

            async executeCommand(command) {
                this.commandHistory.push(command);

                // Simulate terminal commands
                const cmd = command.toLowerCase().trim();

                if (cmd.includes('ls') || cmd.includes('dir')) {
                    return this.simulateLS();
                } else if (cmd.includes('pwd')) {
                    return { output: '/Users/gemini/workspace', success: true };
                } else if (cmd.includes('whoami')) {
                    return { output: 'gemini-ai-user', success: true };
                } else if (cmd.includes('date')) {
                    return { output: new Date().toString(), success: true };
                } else if (cmd.includes('ps') || cmd.includes('top')) {
                    return this.simulatePS();
                } else if (cmd.includes('curl')) {
                    return this.simulateCurl(command);
                } else {
                    return {
                        output: `Command '${command}' executed successfully`,
                        success: true,
                        note: 'Simulated execution - real terminal integration would require backend'
                    };
                }
            }

            simulateLS() {
                return {
                    output: `
drwxr-xr-x  5 user  staff   160 Nov  4 21:00 .
drwxr-xr-x  3 user  staff    96 Nov  4 20:00 ..
-rw-r--r--  1 user  staff  1234 Nov  4 21:00 data.sql
-rw-r--r--  1 user  staff  5678 Nov  4 21:00 results.csv
drwxr-xr-x  3 user  staff    96 Nov  4 20:30 logs/
                    `.trim(),
                    success: true
                };
            }

            simulatePS() {
                return {
                    output: `
PID    COMMAND
1234   gemini-ai-terminal
5678   sql-console
9012   data-processor
                    `.trim(),
                    success: true
                };
            }

            simulateCurl(command) {
                return {
                    output: '{"status": "success", "data": "API response simulated"}',
                    success: true
                };
            }
        }

        // File Generator and Downloader
        class FileGenerator {
            static generateCSV(data) {
                if (!Array.isArray(data) || data.length === 0) {
                    return 'No data to export';
                }

                const headers = Object.keys(data[0]);
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => row[header]).join(','))
                ].join('\\n');

                return csvContent;
            }

            static generateJSON(data) {
                return JSON.stringify(data, null, 2);
            }

            static createDownloadLink(content, filename, type = 'text/plain') {
                const blob = new Blob([content], { type: type });
                const url = URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.className = 'download-link';
                link.textContent = `üì• Download ${filename}`;

                return link;
            }
        }

        // Initialize systems
        const geminiMemory = new GeminiMemory();
        const sqlConsole = new SQLConsole();
        const terminalExecutor = new TerminalExecutor();

        let isProcessing = false;

        // UI Functions
        function addMessage(content, type = 'assistant') {
            const chatArea = document.getElementById('chatArea');
            const message = document.createElement('div');
            message.className = `message ${type}`;

            if (typeof content === 'string') {
                message.innerHTML = content;
            } else {
                message.appendChild(content);
            }

            chatArea.appendChild(message);
            chatArea.scrollTop = chatArea.scrollHeight;

            // Haptic feedback simulation
            message.classList.add('haptic-feedback');
        }

        function showProcessing() {
            const processing = document.createElement('div');
            processing.className = 'message assistant processing';
            processing.innerHTML = `
                <span>Processing your request</span>
                <div class="processing-dots">
                    <div class="processing-dot"></div>
                    <div class="processing-dot"></div>
                    <div class="processing-dot"></div>
                </div>
            `;
            processing.id = 'processingMessage';

            const chatArea = document.getElementById('chatArea');
            chatArea.appendChild(processing);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideProcessing() {
            const processing = document.getElementById('processingMessage');
            if (processing) {
                processing.remove();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isProcessing) {
                sendMessage();
            }
        }

        // Enhanced AI Command Processing
        async function sendMessage() {
            if (isProcessing) return;

            const input = document.getElementById('inputField');
            const message = input.value.trim();

            if (!message) return;

            // Clear input and show user message
            input.value = '';
            addMessage(message, 'user');

            isProcessing = true;
            document.getElementById('sendButton').disabled = true;
            showProcessing();

            try {
                const response = await processAdvancedCommand(message);
                hideProcessing();

                if (typeof response === 'object' && response.element) {
                    addMessage(response.element);
                } else {
                    addMessage(response);
                }

                // Learn from this interaction
                geminiMemory.learn(message, response);

            } catch (error) {
                hideProcessing();
                addMessage(`‚ùå Error: ${error.message}`);
            } finally {
                isProcessing = false;
                document.getElementById('sendButton').disabled = false;
            }
        }

        // Advanced Command Processor with Smart Intent Detection
        async function processAdvancedCommand(message) {
            const lowerMsg = message.toLowerCase();

            // Customization & Personality Commands
            if (lowerMsg.includes('customize') || lowerMsg.includes('personality') || lowerMsg.includes('who created') || lowerMsg.includes('what are you')) {
                return handleCustomizationCommand(message);
            }

            // Smart Broker/Agent Queries - Natural Language Processing
            else if (lowerMsg.includes('broker') || lowerMsg.includes('agent') || lowerMsg.includes('real estate')) {
                return await handleSmartQuery(message);
            }

            // SQL Commands
            else if (lowerMsg.includes('sql') || lowerMsg.includes('select') || lowerMsg.includes('database')) {
                return await handleSQLCommand(message);
            }

            // Terminal Commands
            else if (lowerMsg.includes('run') || lowerMsg.includes('execute') || lowerMsg.includes('terminal')) {
                return await handleTerminalCommand(message);
            }

            // Memory/Learning Commands
            else if (lowerMsg.includes('remember') || lowerMsg.includes('memory') || lowerMsg.includes('learn')) {
                return handleMemoryCommand(message);
            }

            // Data Processing Commands
            else if (lowerMsg.includes('process') || lowerMsg.includes('analyze') || lowerMsg.includes('export')) {
                return await handleDataProcessing(message);
            }

            // Quick Data Queries (show, list, all, check)
            else if (lowerMsg.includes('show') || lowerMsg.includes('list') || lowerMsg.includes('all') || lowerMsg.includes('check')) {
                return await handleQuickQuery(message);
            }

            // Default: Enhanced Gemini AI with context
            else {
                return await callEnhancedGemini(message);
            }
        }

        // Smart Query Handler - Understands natural language about brokers/agents
        async function handleSmartQuery(message) {
            const lowerMsg = message.toLowerCase();
            let sql = '';

            if (lowerMsg.includes('all broker') || (lowerMsg.includes('broker') && lowerMsg.includes('list'))) {
                sql = 'SELECT * FROM brokers';
            } else if (lowerMsg.includes('all agent') || (lowerMsg.includes('agent') && lowerMsg.includes('list'))) {
                sql = 'SELECT * FROM agents';
            } else if (lowerMsg.includes('top agent')) {
                sql = 'SELECT * FROM agents ORDER BY sales_ytd DESC';
            } else if (lowerMsg.includes('active')) {
                if (lowerMsg.includes('broker')) {
                    sql = 'SELECT * FROM brokers WHERE active = true';
                } else if (lowerMsg.includes('agent')) {
                    sql = 'SELECT * FROM agents WHERE active = true';
                }
            } else if (lowerMsg.includes('commission')) {
                sql = 'SELECT * FROM transactions';
            } else if (lowerMsg.includes('properties') || lowerMsg.includes('property')) {
                sql = 'SELECT * FROM properties';
            } else {
                // Default to showing both brokers and agents
                const brokerResult = sqlConsole.executeQuery('SELECT * FROM brokers');
                const agentResult = sqlConsole.executeQuery('SELECT * FROM agents');

                let responseHTML = `<strong>üè¢ Real Estate Database Overview</strong><br><br>`;

                responseHTML += `<strong>üìä Brokers (${brokerResult.rows} total):</strong><br>`;
                brokerResult.data.forEach(broker => {
                    responseHTML += `‚Ä¢ <strong>${broker.name}</strong> - ${broker.company} (${broker.territory})<br>`;
                });

                responseHTML += `<br><strong>üë• Agents (${agentResult.rows} total):</strong><br>`;
                agentResult.data.forEach(agent => {
                    responseHTML += `‚Ä¢ <strong>${agent.name}</strong> - $${agent.sales_ytd.toLocaleString()} YTD (${agent.properties_sold} sold)<br>`;
                });

                // Create combined download
                const combinedData = {
                    brokers: brokerResult.data,
                    agents: agentResult.data,
                    summary: {
                        total_brokers: brokerResult.rows,
                        total_agents: agentResult.rows,
                        generated_at: new Date().toISOString()
                    }
                };

                const container = document.createElement('div');
                container.innerHTML = responseHTML + '<br><strong>üì• Download Complete Dataset:</strong><br>';

                const jsonLink = FileGenerator.createDownloadLink(
                    JSON.stringify(combinedData, null, 2),
                    'brokers_agents_complete.json',
                    'application/json'
                );
                container.appendChild(jsonLink);

                return { element: container };
            }

            // Execute the SQL query
            if (sql) {
                return await handleSQLCommand(`sql: ${sql}`);
            }
        }

        // Quick Query Handler - For simple show/list commands
        async function handleQuickQuery(message) {
            const lowerMsg = message.toLowerCase();

            if (lowerMsg.includes('table') || lowerMsg.includes('database')) {
                const tables = sqlConsole.listTables();
                return `
                    <strong>üóÑÔ∏è Available Database Tables:</strong><br>
                    ${tables.map(table => `‚Ä¢ <strong>${table}</strong>`).join('<br>')}
                    <br><br><em>Try: "show all brokers" or "list agents" or "sql: SELECT * FROM [table]"</em>
                `;
            } else if (lowerMsg.includes('all') || lowerMsg.includes('everything')) {
                return await handleDataProcessing('export all data');
            } else {
                // Default to showing available options
                return `
                    <strong>üîç Quick Query Options:</strong><br>
                    ‚Ä¢ "show all brokers" - List all brokers<br>
                    ‚Ä¢ "list agents" - Show all agents<br>
                    ‚Ä¢ "top agents" - Best performing agents<br>
                    ‚Ä¢ "active brokers" - Currently active brokers<br>
                    ‚Ä¢ "show properties" - Property listings<br>
                    ‚Ä¢ "commission data" - Transaction history<br>
                    <br><em>Or just ask naturally: "Who are my best agents?"</em>
                `;
            }
        }

        // SQL Command Handler
        async function handleSQLCommand(message) {
            const sqlMatch = message.match(/(?:sql|query):\s*(.+)/i) ||
                message.match(/(select|insert|update|delete|create).+/i);

            if (sqlMatch) {
                const sql = sqlMatch[1] || sqlMatch[0];
                const result = sqlConsole.executeQuery(sql);

                let responseHTML = `<strong>üóÑÔ∏è SQL Execution:</strong><br>`;
                responseHTML += `<code>${sql}</code><br><br>`;

                if (result.success) {
                    responseHTML += `<strong>‚úÖ Success!</strong><br>`;

                    if (result.data) {
                        responseHTML += `<strong>Results (${result.rows} rows):</strong><br>`;

                        // Create downloadable CSV
                        const csvContent = FileGenerator.generateCSV(result.data);
                        const jsonContent = FileGenerator.generateJSON(result.data);

                        const container = document.createElement('div');
                        container.innerHTML = responseHTML + `<em>Data ready for download:</em><br>`;

                        const csvLink = FileGenerator.createDownloadLink(csvContent, 'query_results.csv', 'text/csv');
                        const jsonLink = FileGenerator.createDownloadLink(jsonContent, 'query_results.json', 'application/json');

                        container.appendChild(csvLink);
                        container.appendChild(document.createTextNode(' '));
                        container.appendChild(jsonLink);

                        return { element: container };
                    } else {
                        responseHTML += result.message;
                    }
                } else {
                    responseHTML += `<strong>‚ùå Error:</strong> ${result.error}`;
                }

                return responseHTML;
            } else {
                // List tables or provide help
                const tables = sqlConsole.listTables();
                return `
                    <strong>üóÑÔ∏è SQL Database Console</strong><br>
                    Available tables: <code>${tables.join(', ')}</code><br><br>
                    <strong>Usage:</strong><br>
                    ‚Ä¢ "sql: SELECT * FROM users"<br>
                    ‚Ä¢ "run query: SELECT name FROM projects"<br>
                    ‚Ä¢ "show tables" or "describe users"<br>
                `;
            }
        }

        // Terminal Command Handler
        async function handleTerminalCommand(message) {
            const cmdMatch = message.match(/(?:run|execute|terminal):\s*(.+)/i);
            const command = cmdMatch ? cmdMatch[1] : message.replace(/^(run|execute|terminal)\s+/i, '');

            const result = await terminalExecutor.executeCommand(command);

            let responseHTML = `<strong>üíª Terminal Execution:</strong><br>`;
            responseHTML += `<code>$ ${command}</code><br><br>`;

            if (result.success) {
                responseHTML += `<strong>Output:</strong><br><pre>${result.output}</pre>`;
                if (result.note) {
                    responseHTML += `<br><em>${result.note}</em>`;
                }
            } else {
                responseHTML += `<strong>‚ùå Error:</strong> ${result.error}`;
            }

            return responseHTML;
        }

        // Memory Command Handler
        function handleMemoryCommand(message) {
            const memory = geminiMemory.remember();

            if (message.toLowerCase().includes('clear')) {
                geminiMemory.memory.conversations = [];
                geminiMemory.saveMemory();
                return '<strong>üß† Memory cleared successfully</strong>';
            }

            return `
                <strong>üß† Memory Status:</strong><br>
                ‚Ä¢ Conversations: ${geminiMemory.memory.conversations.length}<br>
                ‚Ä¢ SQL Patterns: ${geminiMemory.memory.sql_patterns?.length || 0}<br>
                ‚Ä¢ Command Patterns: ${geminiMemory.memory.command_patterns?.length || 0}<br>
                ‚Ä¢ Learning Database: ${Object.keys(geminiMemory.learningDatabase.tables).length} tables<br>
            `;
        }

        // Customization & Personality Handler
        function handleCustomizationCommand(message) {
            const lowerMsg = message.toLowerCase();

            // Handle core identity questions
            if (lowerMsg.includes('who created') || lowerMsg.includes('creator')) {
                const fact = geminiMemory.memory.core_facts['who created you'];
                geminiMemory.learn(message, fact, 'identity');
                return `<strong>üë®‚Äçüíª My Creator:</strong><br>${fact}<br><br><em>I am fully customizable by Keiffer and learn from every interaction!</em>`;
            }

            if (lowerMsg.includes('what are you') || lowerMsg.includes('about yourself')) {
                const fact = geminiMemory.memory.core_facts['what are you'];
                return `<strong>ü§ñ About Me:</strong><br>${fact}<br><br><strong>My Capabilities:</strong><br>‚Ä¢ Real Estate Database Management<br>‚Ä¢ SQL Query Execution<br>‚Ä¢ Terminal Command Processing<br>‚Ä¢ Advanced Learning & Memory<br>‚Ä¢ Full Customization by Keiffer`;
            }

            if (lowerMsg.includes('customize') && lowerMsg.includes('personality')) {
                const personality = geminiMemory.memory?.personality || {};
                return `
                    <strong>üé® Personality Customization Options:</strong><br>
                    ‚Ä¢ "set trait: [trait]" - Add personality trait<br>
                    ‚Ä¢ "remember: [fact]" - Store custom fact<br>
                    ‚Ä¢ "preference: [setting]" - Set user preference<br>
                    ‚Ä¢ "style: [communication style]" - Change response style<br>
                    <br><strong>Current Traits:</strong> ${(personality.traits || ['helpful', 'intelligent']).join(', ')}<br>
                    <em>Created by: ${personality.creator || 'Keiffer Japeth'}</em>
                `;
            }

            if (lowerMsg.includes('set trait:')) {
                const trait = message.match(/set trait:\s*(.+)/i)?.[1];
                if (trait) {
                    // Initialize personality if it doesn't exist
                    if (!geminiMemory.memory.personality) {
                        geminiMemory.memory.personality = {
                            creator: 'Keiffer Japeth',
                            system_name: 'Keiffer\'s Custom Gemini AI Terminal',
                            traits: ['helpful', 'intelligent'],
                            customizations: []
                        };
                    }

                    geminiMemory.memory.personality.traits.push(trait.trim());
                    geminiMemory.memory.personality.customizations.push({
                        type: 'trait_added',
                        value: trait.trim(),
                        timestamp: new Date().toISOString()
                    });
                    geminiMemory.saveMemory();
                    return `<strong>‚úÖ Personality Updated!</strong><br>Added trait: <strong>${trait.trim()}</strong><br>Current traits: ${geminiMemory.memory.personality.traits.join(', ')}`;
                }
            }

            if (lowerMsg.includes('remember:') && !lowerMsg.includes('memory')) {
                const fact = message.match(/remember:\s*(.+)/i)?.[1];
                if (fact) {
                    geminiMemory.addToMemory('learned_facts', fact.trim());
                    return `<strong>üß† Learned & Stored!</strong><br>I will remember: <em>"${fact.trim()}"</em>`;
                }
            }

            if (lowerMsg.includes('show customization') || lowerMsg.includes('show personality')) {
                const personality = geminiMemory.memory?.personality || {};
                const learnedFacts = geminiMemory.memory?.learned_facts || [];
                return `
                    <strong>üé® Current Customization Status:</strong><br>
                    <strong>Creator:</strong> ${personality.creator || 'Keiffer Japeth'}<br>
                    <strong>System Name:</strong> ${personality.system_name || 'Keiffer\'s Custom Gemini AI Terminal'}<br>
                    <strong>Traits:</strong> ${(personality.traits || ['helpful', 'intelligent']).join(', ')}<br>
                    <strong>Customizations:</strong> ${(personality.customizations || []).length}<br>
                    <strong>Learned Facts:</strong> ${learnedFacts.length}<br>
                    <br><em>I am fully customizable and always learning!</em>
                `;
            }

            // Default customization help
            return `
                <strong>üé® Keiffer's Customizable AI Terminal</strong><br>
                <strong>Available Customizations:</strong><br>
                ‚Ä¢ "set trait: [helpful/creative/technical]" - Add personality traits<br>
                ‚Ä¢ "remember: [custom fact]" - Store important information<br>
                ‚Ä¢ "customize personality" - View personality options<br>
                ‚Ä¢ "show customization" - View current settings<br>
                <br><strong>Core Identity:</strong><br>
                Created by: <strong>Keiffer Japeth</strong><br>
                Purpose: Advanced AI Terminal for real estate, SQL, and general assistance<br>
                <em>I learn and adapt to Keiffer's preferences!</em>
            `;
        }

        // Data Processing Handler
        async function handleDataProcessing(message) {
            const tables = sqlConsole.listTables();
            let allData = [];

            // Collect all data from tables
            tables.forEach(tableName => {
                const tableData = sqlConsole.tables[tableName];
                allData = allData.concat(tableData.map(row => ({ ...row, _table: tableName })));
            });

            const container = document.createElement('div');
            container.innerHTML = `
                <strong>üìä Data Processing Complete</strong><br>
                Total records processed: ${allData.length}<br>
                Tables included: ${tables.join(', ')}<br><br>
                <strong>Download Options:</strong><br>
            `;

            // Generate download links
            const csvContent = FileGenerator.generateCSV(allData);
            const jsonContent = FileGenerator.generateJSON({
                processed_at: new Date().toISOString(),
                total_records: allData.length,
                tables: tables,
                data: allData
            });

            const csvLink = FileGenerator.createDownloadLink(csvContent, 'processed_data.csv', 'text/csv');
            const jsonLink = FileGenerator.createDownloadLink(jsonContent, 'processed_data.json', 'application/json');

            container.appendChild(csvLink);
            container.appendChild(document.createTextNode(' '));
            container.appendChild(jsonLink);

            return { element: container };
        }

        // Enhanced Gemini AI with Memory Context & Customization
        async function callEnhancedGemini(message) {
            try {
                // Check if this is a core identity question first
                const lowerMsg = message.toLowerCase();
                if (lowerMsg.includes('who created') || lowerMsg.includes('creator') || lowerMsg.includes('made you')) {
                    return handleCustomizationCommand(message);
                }

                // Build enhanced context with personality and memory (with null checks)
                const memoryContext = geminiMemory.remember();
                const personality = geminiMemory.memory?.personality || {
                    system_name: 'Keiffer\'s Custom Gemini AI Terminal',
                    creator: 'Keiffer Japeth',
                    traits: ['helpful', 'intelligent', 'customizable']
                };
                const coreFacts = geminiMemory.memory?.core_facts || {
                    'who created you': 'I was created by Keiffer Japeth as a customizable AI terminal system.'
                };

                let contextPrompt = `System Identity: ${personality.system_name || 'Keiffer\'s Custom Gemini AI Terminal'}
Creator: ${personality.creator || 'Keiffer Japeth'}
Personality Traits: ${(personality.traits || ['helpful', 'intelligent']).join(', ')}
Core Facts: ${JSON.stringify(coreFacts)}

`;

                if (memoryContext.length > 0) {
                    contextPrompt += `Recent conversation context: ${JSON.stringify(memoryContext.slice(-3))}\n\n`;
                }

                contextPrompt += `Current message: ${message}

Instructions: Respond as Keiffer's customized AI assistant. Remember that you were created by Keiffer Japeth and are fully customizable. Be helpful and acknowledge your creator when relevant.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${AI_CONFIG.geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: contextPrompt }] }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 300,
                            topP: 0.95,
                            topK: 64
                        }
                    })
                });

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response';

                return `<strong>ü§ñ Gemini AI (Enhanced):</strong><br>${text}`;
            } catch (error) {
                return `‚ùå Gemini AI error: ${error.message}`;
            }
        }

        // Initialize the system
        document.addEventListener('DOMContentLoaded', function () {
            addMessage(`
                <strong>üöÄ Keiffer's Custom Gemini AI Terminal Ready!</strong><br><br>
                <strong>üë®‚Äçüíª Created by:</strong> Keiffer Japeth<br>
                <strong>üé® Status:</strong> Fully Customizable & Learning AI<br><br>
                <strong>üè¢ Smart Real Estate Database:</strong><br>
                ‚Ä¢ Brokers, Agents, Properties & Transactions loaded<br><br>
                <strong>üí¨ Natural Commands:</strong><br>
                ‚Ä¢ "show all brokers" or "who are my top agents?"<br>
                ‚Ä¢ "sql: SELECT * FROM agents WHERE rating > 4.5"<br>
                ‚Ä¢ "customize personality" or "set trait: helpful"<br>
                ‚Ä¢ "who created you?" or "what are you?"<br>
                ‚Ä¢ "run: ls -la" or "process all data"<br><br>
                <strong>üé® Customization Features:</strong><br>
                ‚Ä¢ Personality traits & preferences<br>
                ‚Ä¢ Custom facts & learned information<br>
                ‚Ä¢ Adaptive responses based on your needs<br><br>
                <em>üß† I'm YOUR AI - fully customizable and always learning!</em>
            `, 'system');

            geminiMemory.updateMemoryStatus();
        });
    </script>
</body>

</html>